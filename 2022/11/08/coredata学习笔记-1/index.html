<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CoreData 学习笔记一-CoreData基本概念 | fanthus&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/logo.jpg">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <script async="true" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3512514942188386" crossorigin="anonymous"></script>
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-MEH5F43SVB"></script>
    <script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-MEH5F43SVB');</script>
    <script>console.log("my name is fanthus, hope my blog bring new ideas to you.");</script>
    <meta name="description" content="这篇笔记主要是介绍一些 CoreData 的基本概念。Core Data 是苹果提供的数据持久化方案。相对于 Sqlite，CoreData 提供了原生的 ORM 的支持，以及可以和苹果的 Cloud 服务进行通信，对于独立开发者来说，这是成本很低的数据存储方案，目前也是很多开发者使用的技术栈。

Core Data 我自己感觉稍微有一定的使用门槛，不过苹果这几年也在不断地降低CoreData A ...">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.232103a7.css" as="style"><link rel="preload" href="/assets/js/app.5c2aadbb.js" as="script"><link rel="preload" href="/assets/js/29.1acae59f.js" as="script"><link rel="preload" href="/assets/js/3.7fe07bf0.js" as="script"><link rel="preload" href="/assets/js/60.f78b3bf5.js" as="script"><link rel="prefetch" href="/assets/js/10.e6af762e.js"><link rel="prefetch" href="/assets/js/100.67476119.js"><link rel="prefetch" href="/assets/js/101.f5eb858c.js"><link rel="prefetch" href="/assets/js/102.03da866a.js"><link rel="prefetch" href="/assets/js/103.fb86a639.js"><link rel="prefetch" href="/assets/js/104.3cfe1a59.js"><link rel="prefetch" href="/assets/js/105.06df8093.js"><link rel="prefetch" href="/assets/js/106.3b985ff7.js"><link rel="prefetch" href="/assets/js/107.bc3ffbc8.js"><link rel="prefetch" href="/assets/js/108.4b873cd8.js"><link rel="prefetch" href="/assets/js/109.cf2e8bfc.js"><link rel="prefetch" href="/assets/js/11.ec904e86.js"><link rel="prefetch" href="/assets/js/110.d0e1f360.js"><link rel="prefetch" href="/assets/js/111.32710987.js"><link rel="prefetch" href="/assets/js/112.17690a92.js"><link rel="prefetch" href="/assets/js/113.589070d1.js"><link rel="prefetch" href="/assets/js/114.bec863ac.js"><link rel="prefetch" href="/assets/js/115.66decc99.js"><link rel="prefetch" href="/assets/js/116.b3bfe4dc.js"><link rel="prefetch" href="/assets/js/117.75a5a39d.js"><link rel="prefetch" href="/assets/js/118.e0dd863f.js"><link rel="prefetch" href="/assets/js/119.94c2e0bb.js"><link rel="prefetch" href="/assets/js/12.14256cbe.js"><link rel="prefetch" href="/assets/js/120.c8b76def.js"><link rel="prefetch" href="/assets/js/121.dfdfd9b0.js"><link rel="prefetch" href="/assets/js/122.10da6a05.js"><link rel="prefetch" href="/assets/js/123.e9d46721.js"><link rel="prefetch" href="/assets/js/124.577feddf.js"><link rel="prefetch" href="/assets/js/125.8129b423.js"><link rel="prefetch" href="/assets/js/126.c20f17ba.js"><link rel="prefetch" href="/assets/js/127.7e1c5ded.js"><link rel="prefetch" href="/assets/js/128.5d4e17c0.js"><link rel="prefetch" href="/assets/js/129.f1c8af0e.js"><link rel="prefetch" href="/assets/js/13.6af70c38.js"><link rel="prefetch" href="/assets/js/14.95f777b8.js"><link rel="prefetch" href="/assets/js/15.9c1287ff.js"><link rel="prefetch" href="/assets/js/16.a57aacc5.js"><link rel="prefetch" href="/assets/js/17.5c124641.js"><link rel="prefetch" href="/assets/js/18.6db94c74.js"><link rel="prefetch" href="/assets/js/19.60cf2d9c.js"><link rel="prefetch" href="/assets/js/20.08713c1b.js"><link rel="prefetch" href="/assets/js/21.5eadef54.js"><link rel="prefetch" href="/assets/js/22.66422fed.js"><link rel="prefetch" href="/assets/js/23.739fb024.js"><link rel="prefetch" href="/assets/js/24.c76333d1.js"><link rel="prefetch" href="/assets/js/25.8b10e134.js"><link rel="prefetch" href="/assets/js/26.cfba7153.js"><link rel="prefetch" href="/assets/js/27.72eb7481.js"><link rel="prefetch" href="/assets/js/28.6dcef05c.js"><link rel="prefetch" href="/assets/js/30.2b7c71b4.js"><link rel="prefetch" href="/assets/js/31.5ca92641.js"><link rel="prefetch" href="/assets/js/32.8daba902.js"><link rel="prefetch" href="/assets/js/33.6edbf98d.js"><link rel="prefetch" href="/assets/js/34.84367f88.js"><link rel="prefetch" href="/assets/js/35.85b0ec62.js"><link rel="prefetch" href="/assets/js/36.6cf4ed41.js"><link rel="prefetch" href="/assets/js/37.ee892674.js"><link rel="prefetch" href="/assets/js/38.b7997b04.js"><link rel="prefetch" href="/assets/js/39.90e0d74a.js"><link rel="prefetch" href="/assets/js/4.03934060.js"><link rel="prefetch" href="/assets/js/40.dfc8ad6a.js"><link rel="prefetch" href="/assets/js/41.b60c8046.js"><link rel="prefetch" href="/assets/js/42.77c1c836.js"><link rel="prefetch" href="/assets/js/43.c9d4221c.js"><link rel="prefetch" href="/assets/js/44.6348d9cc.js"><link rel="prefetch" href="/assets/js/45.126bc7fe.js"><link rel="prefetch" href="/assets/js/46.4a3e70e0.js"><link rel="prefetch" href="/assets/js/47.67a75c47.js"><link rel="prefetch" href="/assets/js/48.83f0f7f0.js"><link rel="prefetch" href="/assets/js/49.f7dc76c9.js"><link rel="prefetch" href="/assets/js/5.543a8f29.js"><link rel="prefetch" href="/assets/js/50.e7cc6057.js"><link rel="prefetch" href="/assets/js/51.adabfc4f.js"><link rel="prefetch" href="/assets/js/52.e28c8d20.js"><link rel="prefetch" href="/assets/js/53.13d2e30c.js"><link rel="prefetch" href="/assets/js/54.c393a991.js"><link rel="prefetch" href="/assets/js/55.460bb0db.js"><link rel="prefetch" href="/assets/js/56.2d1300fd.js"><link rel="prefetch" href="/assets/js/57.6ea9c916.js"><link rel="prefetch" href="/assets/js/58.65b856f8.js"><link rel="prefetch" href="/assets/js/59.6a97c2b7.js"><link rel="prefetch" href="/assets/js/6.34df74c1.js"><link rel="prefetch" href="/assets/js/61.bee131bd.js"><link rel="prefetch" href="/assets/js/62.20ab782f.js"><link rel="prefetch" href="/assets/js/63.7055d872.js"><link rel="prefetch" href="/assets/js/64.d894c341.js"><link rel="prefetch" href="/assets/js/65.b39cadbd.js"><link rel="prefetch" href="/assets/js/66.7a13fc1f.js"><link rel="prefetch" href="/assets/js/67.a6766c4f.js"><link rel="prefetch" href="/assets/js/68.80cf9177.js"><link rel="prefetch" href="/assets/js/69.8ca05e24.js"><link rel="prefetch" href="/assets/js/7.2861f040.js"><link rel="prefetch" href="/assets/js/70.5802ac79.js"><link rel="prefetch" href="/assets/js/71.a8629828.js"><link rel="prefetch" href="/assets/js/72.3b93f7e3.js"><link rel="prefetch" href="/assets/js/73.c8c6e94d.js"><link rel="prefetch" href="/assets/js/74.dbeef2ae.js"><link rel="prefetch" href="/assets/js/75.a71f1c86.js"><link rel="prefetch" href="/assets/js/76.8ea1e96d.js"><link rel="prefetch" href="/assets/js/77.53f0b3f9.js"><link rel="prefetch" href="/assets/js/78.a6e06276.js"><link rel="prefetch" href="/assets/js/79.d7641e2b.js"><link rel="prefetch" href="/assets/js/8.2e921966.js"><link rel="prefetch" href="/assets/js/80.ea6354e1.js"><link rel="prefetch" href="/assets/js/81.a9b14e4a.js"><link rel="prefetch" href="/assets/js/82.1634e735.js"><link rel="prefetch" href="/assets/js/83.0cf5ca64.js"><link rel="prefetch" href="/assets/js/84.a70476ff.js"><link rel="prefetch" href="/assets/js/85.d2b36360.js"><link rel="prefetch" href="/assets/js/86.251249e0.js"><link rel="prefetch" href="/assets/js/87.7f2a1a00.js"><link rel="prefetch" href="/assets/js/88.911418c4.js"><link rel="prefetch" href="/assets/js/89.23d86aa2.js"><link rel="prefetch" href="/assets/js/9.f375de0b.js"><link rel="prefetch" href="/assets/js/90.7a69da44.js"><link rel="prefetch" href="/assets/js/91.acb56149.js"><link rel="prefetch" href="/assets/js/92.8b6fb89a.js"><link rel="prefetch" href="/assets/js/93.01d50793.js"><link rel="prefetch" href="/assets/js/94.e6a5de4e.js"><link rel="prefetch" href="/assets/js/95.5ddea806.js"><link rel="prefetch" href="/assets/js/96.9ce28405.js"><link rel="prefetch" href="/assets/js/97.f82294e4.js"><link rel="prefetch" href="/assets/js/98.27393bcb.js"><link rel="prefetch" href="/assets/js/99.b851e6bb.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.b6901552.js">
    <link rel="stylesheet" href="/assets/css/0.styles.232103a7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">fanthus's blog </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/" class="nav-link">Blog</a></li><li class="nav-item"><a href="/tag/" class="nav-link">Tags</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">fanthus's blog </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/" class="nav-link">Blog</a></li><li class="mobile-nav-item"><a href="/tag/" class="nav-link">Tags</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        CoreData 学习笔记一-CoreData基本概念
      </h1> <div class="post-meta"><!----> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2022-11-08T18:18:05.000Z">
      Tue Nov 08 2022
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-42ccfcd5><a href="/tag/CoreData" data-v-42ccfcd5><span data-v-42ccfcd5>CoreData</span></a></li><li class="post-tag" data-v-42ccfcd5><a href="/tag/iOS" data-v-42ccfcd5><span data-v-42ccfcd5>iOS</span></a></li><li class="post-tag" data-v-42ccfcd5><a href="/tag/macOS" data-v-42ccfcd5><span data-v-42ccfcd5>macOS</span></a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><p>这篇笔记主要是介绍一些 CoreData 的基本概念。Core Data 是苹果提供的数据持久化方案。相对于 Sqlite，CoreData 提供了原生的 ORM 的支持，以及可以和苹果的 Cloud 服务进行通信，对于独立开发者来说，这是成本很低的数据存储方案，目前也是很多开发者使用的技术栈。</p> <p>Core Data 我自己感觉稍微有一定的使用门槛，不过苹果这几年也在不断地降低CoreData API 和相关概念的使用和理解难度，这部分的技术储备还是要进行的。</p> <p>我尝试从 CoreData Stack 这里开始理清 CoreData 相关的比较难理解的概念。事实上也就 CoreData Stack 这里比较难理解。</p> <h2 id="coredata-stack"><a href="#coredata-stack" class="header-anchor">#</a> CoreData Stack</h2> <p>CoreData Stack 就是一组 framework 对象，这组对象作为 CoreData 初始化部分以及用于管理在应用内对象和外部数据源交互。CoreData Stack 负责所有和外部数据源打交道工作，这样我们业务方只需要关心自己的业务逻辑就可以了。CoreData Stack 主要包含四种对象</p> <ol><li>NSManagedObjectContext</li> <li>NSPersistentStoreCoordinator,</li> <li>NSManagedObjectModel</li> <li>NSPersistentContainer</li></ol> <p>接下来一个个说下这几个关键对象</p> <ol><li><strong>NSManagedObjectModel 👉</strong> 这个 <code>NSManagedObjectModel</code> 实例描述了被 CoreData Stack 访问的数据。其实就是用程序化的方式描述了 <em>.xcdatamodeld</em> 里的对象。当开始初始化 Core Data stack 的时候，数据库文件最先被加载进内存和 <code>NSManagedObjectModel</code> 形成映射关系，系统当然知道要加载的文件的名字。</li> <li><strong>NSPersistentStoreCoordinator</strong> <strong>👉</strong>  位于 CoreData Stack 的中间层，负责将定义在 model 里的实体实例化，也可以从持久化存储(<code>NSPersistentStore</code>)里获取实例。所以它的职责就是根据  <code>NSManagedObjectModel</code> 的定义，从持久化存储里取出或者创造实例对象，并且将这些对象传给 <code>NSManagedObjectContext</code>. 同时也会校验数据的一致性?(这个不是很明白)</li> <li><strong>NSManagedObjectContext</strong> 👉 这个对象是我们应用调用最多的，应用就是通过它从持久化存储(persistent store)获取一份临时的数据，然后应用可以任意改变这份数据，如果你不主动调save方法，那持久化存储里的数据是保持不变的。我们就是通过这个 context 来对数据进行增删等操作，这个 context 也会追踪我们做了哪些操作，这样它就可以试下undo/redo 这些操作了。而当我们主动调 save 方法的时候，context 会确保我们的数据是有效的，有效的话就直接写回到持久化存储里面。</li></ol> <p><img src="/assets/img/coredata_stack.b248baa4.png" alt="CoreDataStack"></p> <h3 id="coredata-stack-初始化"><a href="#coredata-stack-初始化" class="header-anchor">#</a> CoreData Stack 初始化</h3> <p>我们只能在初始化 CoreDataStack 栈之后才能在应用中访问外部数据源，下面这几行代码就是 CoreDataStack 的创建：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code>lazy <span class="token keyword">var</span> <span class="token literal-property property">persistentContainer</span><span class="token operator">:</span> NSPersistentContainer <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> container <span class="token operator">=</span> <span class="token function">NSPersistentContainer</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token string">&quot;CoreDataDemo&quot;</span><span class="token punctuation">)</span>
    container<span class="token punctuation">.</span><span class="token function">loadPersistentStores</span><span class="token punctuation">(</span>completionHandler<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">(</span>storeDescription<span class="token punctuation">,</span> error<span class="token punctuation">)</span> <span class="token keyword">in</span>
        <span class="token keyword">if</span> <span class="token keyword">let</span> error <span class="token operator">=</span> error <span class="token keyword">as</span> NSError<span class="token operator">?</span> <span class="token punctuation">{</span>
            <span class="token function">NSLog</span><span class="token punctuation">(</span>@<span class="token string">&quot;Failed to load Core Data stack: %@&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">fatalError</span><span class="token punctuation">(</span><span class="token string">&quot;Unresolved error \(error), \(error.userInfo)&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> container
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>loadPersistentStores(completionHandler:) API 说明：Once the persistent container has been initialized, you need to execute <code>loadPersistentStores(completionHandler:)</code> to instruct the container to load the persistent stores and complete the creation of the Core Data stack. <strong>Once the completion handler has fired, the stack is fully initialized and is ready for use.</strong> The completion handler will be called once for each persistent store that is created.</p></blockquote> <p>可以看到所谓 CoreData Stack 的初始化其实就是创建了一个 <code>NSPersistentContainer</code>，然后去加载了本地的持久化存储。</p> <p>本质上 <code>NSPersistentContainer</code> 的使用其实是把 CoreData Stack 的比较复杂的流程封装起来了，当我们创建 <code>NSPersistentContainer</code> 的时候，本质上也创建了 <code>NSManagedObjectModel</code>，<code>NSPersistentStoreCoordinator</code> 以及 <code>NSManagedObjectContext</code>。</p> <p>在 iOS10 之前还有一种比较原始的的 CoreData Stack 初始方式，在这种方式里，你可以比较清楚的看到 CoreData Stack 里的对象是如何协作的。</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token function">init</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">completionClosure</span><span class="token operator">:</span> @<span class="token function">escaping</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//1. 初始化 NSManagedObjectModel.</span>
    <span class="token comment">//2. 通过 NSManagedObjectModel 初始化 NSPersistentStoreCoordinator</span>
    <span class="token comment">//3. 通过 NSPersistentStoreCoordinator 初始化 NSManagedContext.</span>
    <span class="token comment">//This resource is the same name as your xcdatamodeld contained in your project</span>
    guard <span class="token keyword">let</span> modelURL <span class="token operator">=</span> Bundle<span class="token punctuation">.</span>main<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span>forResource<span class="token operator">:</span> <span class="token string">&quot;DataModel&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">withExtension</span><span class="token operator">:</span><span class="token string">&quot;momd&quot;</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">fatalError</span><span class="token punctuation">(</span><span class="token string">&quot;Error loading model from bundle&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// The managed object model for the application. It is a fatal error for the application not to be able to find and load its model.</span>
    guard <span class="token keyword">let</span> mom <span class="token operator">=</span> <span class="token function">NSManagedObjectModel</span><span class="token punctuation">(</span>contentsOf<span class="token operator">:</span> modelURL<span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">fatalError</span><span class="token punctuation">(</span><span class="token string">&quot;Error initializing mom from: \(modelURL)&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
	  <span class="token comment">//</span>
    <span class="token keyword">let</span> psc <span class="token operator">=</span> <span class="token function">NSPersistentStoreCoordinator</span><span class="token punctuation">(</span>managedObjectModel<span class="token operator">:</span> mom<span class="token punctuation">)</span>
    managedObjectContext <span class="token operator">=</span> <span class="token function">NSManagedObjectContext</span><span class="token punctuation">(</span>concurrencyType<span class="token operator">:</span> NSManagedObjectContextConcurrencyType<span class="token punctuation">.</span>mainQueueConcurrencyType<span class="token punctuation">)</span>
    managedObjectContext<span class="token punctuation">.</span>persistentStoreCoordinator <span class="token operator">=</span> psc
    <span class="token comment">//</span>
    <span class="token keyword">let</span> queue <span class="token operator">=</span> DispatchQueue<span class="token punctuation">.</span><span class="token function">global</span><span class="token punctuation">(</span>qos<span class="token operator">:</span> DispatchQoS<span class="token punctuation">.</span>QoSClass<span class="token punctuation">.</span>background<span class="token punctuation">)</span>
    queue<span class="token punctuation">.</span>async <span class="token punctuation">{</span>
        guard <span class="token keyword">let</span> docURL <span class="token operator">=</span> FileManager<span class="token punctuation">.</span>default<span class="token punctuation">.</span><span class="token function">urls</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token operator">:</span> <span class="token punctuation">.</span>documentDirectory<span class="token punctuation">,</span> <span class="token keyword">in</span><span class="token operator">:</span> <span class="token punctuation">.</span>userDomainMask<span class="token punctuation">)</span><span class="token punctuation">.</span>last <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">fatalError</span><span class="token punctuation">(</span><span class="token string">&quot;Unable to resolve document directory&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> storeURL <span class="token operator">=</span> docURL<span class="token punctuation">.</span><span class="token function">appendingPathComponent</span><span class="token punctuation">(</span><span class="token string">&quot;DataModel.sqlite&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">do</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> psc<span class="token punctuation">.</span><span class="token function">addPersistentStore</span><span class="token punctuation">(</span>ofType<span class="token operator">:</span> NSSQLiteStoreType<span class="token punctuation">,</span> <span class="token literal-property property">configurationName</span><span class="token operator">:</span> nil<span class="token punctuation">,</span> <span class="token literal-property property">at</span><span class="token operator">:</span> storeURL<span class="token punctuation">,</span> <span class="token literal-property property">options</span><span class="token operator">:</span> nil<span class="token punctuation">)</span>
            <span class="token comment">//The callback block is expected to complete the User Interface and therefore should be presented back on the main queue so that the user interface does not need to be concerned with which queue this call is coming from.</span>
            DispatchQueue<span class="token punctuation">.</span>main<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span>execute<span class="token operator">:</span> completionClosure<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
            <span class="token function">fatalError</span><span class="token punctuation">(</span><span class="token string">&quot;Error migrating store: \(error)&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>但是上面这些创建流程看起来实在复杂，于是出现了 <code>NSPersistentContainer</code> 来简化 CoreData Stack 的初始化流程。<code>NSPersistentContainer</code> 也提供了配置类 <code>NSPersistentStoreDescription</code> 来简化 CoreData 的配置，我们在后面会不断看到 CoreData 的配置。</p> <p>参考地址:</p> <ol><li><a href="https://www.notion.so/CoreData-CloudKit-ccb9e515679e4bb290d4a0d2b3602f77" target="_blank" rel="noopener noreferrer">Core Data Programming Guide-Initializing the Core Data Stack<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.fatbobman.com/posts/masteringOfCoreDataStack/" target="_blank" rel="noopener noreferrer">肘子的Swift记事本-掌握 Core Data Stack<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol> <p>相关链接:</p> <ul><li><a href="https://fanthus.github.io/2022/11/08/coredata%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-1/" target="_blank" rel="noopener noreferrer">CoreData学习笔记 1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://fanthus.github.io/2022/11/24/coredata%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-2/" target="_blank" rel="noopener noreferrer">CoreData学习笔记 2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://fanthus.github.io/2022/11/24/coredata%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-3/" target="_blank" rel="noopener noreferrer">CoreData学习笔记 3<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://fanthus.github.io/2022/11/25/coredata%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-4/" target="_blank" rel="noopener noreferrer">CoreData学习笔记 4<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <!----></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#coredata-stack" title="CoreData Stack">CoreData Stack</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#coredata-stack-初始化" title="CoreData Stack 初始化">CoreData Stack 初始化</a></div></div></div></div> <footer class="footer" data-v-3d9deeb8><div class="footer-left-wrap" data-v-3d9deeb8><ul class="contact" data-v-3d9deeb8></ul></div> <div class="footer-right-wrap" data-v-3d9deeb8><ul class="copyright" data-v-3d9deeb8></ul></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.5c2aadbb.js" defer></script><script src="/assets/js/29.1acae59f.js" defer></script><script src="/assets/js/3.7fe07bf0.js" defer></script><script src="/assets/js/60.f78b3bf5.js" defer></script>
  </body>
</html>
