<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CoreData å­¦ä¹ ç¬”è®°ä¸€-CoreDataåŸºæœ¬æ¦‚å¿µ | fanthus&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/logo.jpg">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <script async="true" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3512514942188386" crossorigin="anonymous"></script>
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-MEH5F43SVB"></script>
    <script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-MEH5F43SVB');</script>
    <script>console.log("my name is fanthus, hope my blog bring new ideas to you.");</script>
    <meta name="description" content="è¿™ç¯‡ç¬”è®°ä¸»è¦æ˜¯ä»‹ç»ä¸€äº› CoreData çš„åŸºæœ¬æ¦‚å¿µã€‚Core Data æ˜¯è‹¹æœæä¾›çš„æ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆã€‚ç›¸å¯¹äº Sqliteï¼ŒCoreData æä¾›äº†åŸç”Ÿçš„ ORM çš„æ”¯æŒï¼Œä»¥åŠå¯ä»¥å’Œè‹¹æœçš„ Cloud æœåŠ¡è¿›è¡Œé€šä¿¡ï¼Œå¯¹äºç‹¬ç«‹å¼€å‘è€…æ¥è¯´ï¼Œè¿™æ˜¯æˆæœ¬å¾ˆä½çš„æ•°æ®å­˜å‚¨æ–¹æ¡ˆï¼Œç›®å‰ä¹Ÿæ˜¯å¾ˆå¤šå¼€å‘è€…ä½¿ç”¨çš„æŠ€æœ¯æ ˆã€‚

Core Data æˆ‘è‡ªå·±æ„Ÿè§‰ç¨å¾®æœ‰ä¸€å®šçš„ä½¿ç”¨é—¨æ§›ï¼Œä¸è¿‡è‹¹æœè¿™å‡ å¹´ä¹Ÿåœ¨ä¸æ–­åœ°é™ä½CoreData A ...">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.232103a7.css" as="style"><link rel="preload" href="/assets/js/app.2cedb1d8.js" as="script"><link rel="preload" href="/assets/js/29.309f71c0.js" as="script"><link rel="preload" href="/assets/js/3.e78f3171.js" as="script"><link rel="preload" href="/assets/js/60.417e91a2.js" as="script"><link rel="prefetch" href="/assets/js/10.4cd31608.js"><link rel="prefetch" href="/assets/js/100.3443112a.js"><link rel="prefetch" href="/assets/js/101.e0037931.js"><link rel="prefetch" href="/assets/js/102.f4c7589f.js"><link rel="prefetch" href="/assets/js/103.0df46cd4.js"><link rel="prefetch" href="/assets/js/104.17a0ee44.js"><link rel="prefetch" href="/assets/js/105.57832bba.js"><link rel="prefetch" href="/assets/js/106.680eda55.js"><link rel="prefetch" href="/assets/js/107.410f297e.js"><link rel="prefetch" href="/assets/js/108.fb80d3ad.js"><link rel="prefetch" href="/assets/js/109.699c7520.js"><link rel="prefetch" href="/assets/js/11.7393e510.js"><link rel="prefetch" href="/assets/js/110.d4f0aca9.js"><link rel="prefetch" href="/assets/js/111.372545eb.js"><link rel="prefetch" href="/assets/js/112.bc127403.js"><link rel="prefetch" href="/assets/js/113.414e616f.js"><link rel="prefetch" href="/assets/js/114.d8c4fe8d.js"><link rel="prefetch" href="/assets/js/115.279ec90c.js"><link rel="prefetch" href="/assets/js/116.c60ac54a.js"><link rel="prefetch" href="/assets/js/117.15c04390.js"><link rel="prefetch" href="/assets/js/118.f9d8228c.js"><link rel="prefetch" href="/assets/js/119.719d77b5.js"><link rel="prefetch" href="/assets/js/12.c35fa779.js"><link rel="prefetch" href="/assets/js/120.cf48f47a.js"><link rel="prefetch" href="/assets/js/121.4aad0ac7.js"><link rel="prefetch" href="/assets/js/122.15f2b5ef.js"><link rel="prefetch" href="/assets/js/123.4dea98c9.js"><link rel="prefetch" href="/assets/js/124.0152be90.js"><link rel="prefetch" href="/assets/js/125.ecf56222.js"><link rel="prefetch" href="/assets/js/126.50fe6660.js"><link rel="prefetch" href="/assets/js/127.28abe492.js"><link rel="prefetch" href="/assets/js/128.48a0862c.js"><link rel="prefetch" href="/assets/js/129.77b2b203.js"><link rel="prefetch" href="/assets/js/13.35658260.js"><link rel="prefetch" href="/assets/js/130.d0ef4952.js"><link rel="prefetch" href="/assets/js/131.55b00f57.js"><link rel="prefetch" href="/assets/js/14.4e33e6a2.js"><link rel="prefetch" href="/assets/js/15.345a84a1.js"><link rel="prefetch" href="/assets/js/16.3d596c76.js"><link rel="prefetch" href="/assets/js/17.3e2e1a7a.js"><link rel="prefetch" href="/assets/js/18.c8e88810.js"><link rel="prefetch" href="/assets/js/19.f0e3f187.js"><link rel="prefetch" href="/assets/js/20.cb5c866b.js"><link rel="prefetch" href="/assets/js/21.b83191ac.js"><link rel="prefetch" href="/assets/js/22.bea483cb.js"><link rel="prefetch" href="/assets/js/23.3877c278.js"><link rel="prefetch" href="/assets/js/24.0524a7e6.js"><link rel="prefetch" href="/assets/js/25.3f3c78fe.js"><link rel="prefetch" href="/assets/js/26.3f72710f.js"><link rel="prefetch" href="/assets/js/27.f35bb8e9.js"><link rel="prefetch" href="/assets/js/28.5e29b9fe.js"><link rel="prefetch" href="/assets/js/30.a60200be.js"><link rel="prefetch" href="/assets/js/31.c2accd33.js"><link rel="prefetch" href="/assets/js/32.41be2bbb.js"><link rel="prefetch" href="/assets/js/33.8447af66.js"><link rel="prefetch" href="/assets/js/34.122a4606.js"><link rel="prefetch" href="/assets/js/35.fa9f0fe8.js"><link rel="prefetch" href="/assets/js/36.ffc459c1.js"><link rel="prefetch" href="/assets/js/37.12421aeb.js"><link rel="prefetch" href="/assets/js/38.66884bf5.js"><link rel="prefetch" href="/assets/js/39.4901c209.js"><link rel="prefetch" href="/assets/js/4.41416bc4.js"><link rel="prefetch" href="/assets/js/40.726f0f90.js"><link rel="prefetch" href="/assets/js/41.1466329e.js"><link rel="prefetch" href="/assets/js/42.ad110115.js"><link rel="prefetch" href="/assets/js/43.42f6c87f.js"><link rel="prefetch" href="/assets/js/44.38a3ffda.js"><link rel="prefetch" href="/assets/js/45.54729d58.js"><link rel="prefetch" href="/assets/js/46.688f019f.js"><link rel="prefetch" href="/assets/js/47.069217c5.js"><link rel="prefetch" href="/assets/js/48.0227b0c3.js"><link rel="prefetch" href="/assets/js/49.7a3d3511.js"><link rel="prefetch" href="/assets/js/5.9be8c1b7.js"><link rel="prefetch" href="/assets/js/50.35d1d592.js"><link rel="prefetch" href="/assets/js/51.7e7b901a.js"><link rel="prefetch" href="/assets/js/52.f693d3ed.js"><link rel="prefetch" href="/assets/js/53.c4c4d1a2.js"><link rel="prefetch" href="/assets/js/54.eab66332.js"><link rel="prefetch" href="/assets/js/55.7e80dbb1.js"><link rel="prefetch" href="/assets/js/56.1041c5f3.js"><link rel="prefetch" href="/assets/js/57.a7c1bc68.js"><link rel="prefetch" href="/assets/js/58.c07c376a.js"><link rel="prefetch" href="/assets/js/59.8b20d651.js"><link rel="prefetch" href="/assets/js/6.1724a888.js"><link rel="prefetch" href="/assets/js/61.4db451fd.js"><link rel="prefetch" href="/assets/js/62.8f0bdaac.js"><link rel="prefetch" href="/assets/js/63.911f46a9.js"><link rel="prefetch" href="/assets/js/64.60deeb3e.js"><link rel="prefetch" href="/assets/js/65.201e0e08.js"><link rel="prefetch" href="/assets/js/66.248f04bf.js"><link rel="prefetch" href="/assets/js/67.500ae9a1.js"><link rel="prefetch" href="/assets/js/68.a95fd5e5.js"><link rel="prefetch" href="/assets/js/69.24aaae86.js"><link rel="prefetch" href="/assets/js/7.934b58e4.js"><link rel="prefetch" href="/assets/js/70.ec2f6ce6.js"><link rel="prefetch" href="/assets/js/71.b454fdd6.js"><link rel="prefetch" href="/assets/js/72.74299778.js"><link rel="prefetch" href="/assets/js/73.3cd8645d.js"><link rel="prefetch" href="/assets/js/74.d5accf5c.js"><link rel="prefetch" href="/assets/js/75.2d01044b.js"><link rel="prefetch" href="/assets/js/76.f31f74e1.js"><link rel="prefetch" href="/assets/js/77.3b826970.js"><link rel="prefetch" href="/assets/js/78.b7547141.js"><link rel="prefetch" href="/assets/js/79.5d0ef470.js"><link rel="prefetch" href="/assets/js/8.2a195ce5.js"><link rel="prefetch" href="/assets/js/80.0b0b5a17.js"><link rel="prefetch" href="/assets/js/81.24f2588e.js"><link rel="prefetch" href="/assets/js/82.f8c84af4.js"><link rel="prefetch" href="/assets/js/83.7fff9a1b.js"><link rel="prefetch" href="/assets/js/84.c0208c2c.js"><link rel="prefetch" href="/assets/js/85.e363b25e.js"><link rel="prefetch" href="/assets/js/86.5837e9f1.js"><link rel="prefetch" href="/assets/js/87.3e2f38a0.js"><link rel="prefetch" href="/assets/js/88.d3958f6f.js"><link rel="prefetch" href="/assets/js/89.ec3fdee0.js"><link rel="prefetch" href="/assets/js/9.c0adb174.js"><link rel="prefetch" href="/assets/js/90.94654c43.js"><link rel="prefetch" href="/assets/js/91.76b106e7.js"><link rel="prefetch" href="/assets/js/92.69e5bf8b.js"><link rel="prefetch" href="/assets/js/93.3d4a8f29.js"><link rel="prefetch" href="/assets/js/94.202d1036.js"><link rel="prefetch" href="/assets/js/95.002d5790.js"><link rel="prefetch" href="/assets/js/96.044893c5.js"><link rel="prefetch" href="/assets/js/97.c6dec31d.js"><link rel="prefetch" href="/assets/js/98.20673f07.js"><link rel="prefetch" href="/assets/js/99.fa4a2cf2.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.91ff346d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.232103a7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">fanthus's blog </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/" class="nav-link">Blog</a></li><li class="nav-item"><a href="/tag/" class="nav-link">Tags</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">fanthus's blog </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/" class="nav-link">Blog</a></li><li class="mobile-nav-item"><a href="/tag/" class="nav-link">Tags</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        CoreData å­¦ä¹ ç¬”è®°ä¸€-CoreDataåŸºæœ¬æ¦‚å¿µ
      </h1> <div class="post-meta"><!----> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2022-11-08T18:18:05.000Z">
      Tue Nov 08 2022
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-42ccfcd5><a href="/tag/CoreData" data-v-42ccfcd5><span data-v-42ccfcd5>CoreData</span></a></li><li class="post-tag" data-v-42ccfcd5><a href="/tag/iOS" data-v-42ccfcd5><span data-v-42ccfcd5>iOS</span></a></li><li class="post-tag" data-v-42ccfcd5><a href="/tag/macOS" data-v-42ccfcd5><span data-v-42ccfcd5>macOS</span></a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><p>è¿™ç¯‡ç¬”è®°ä¸»è¦æ˜¯ä»‹ç»ä¸€äº› CoreData çš„åŸºæœ¬æ¦‚å¿µã€‚Core Data æ˜¯è‹¹æœæä¾›çš„æ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆã€‚ç›¸å¯¹äº Sqliteï¼ŒCoreData æä¾›äº†åŸç”Ÿçš„ ORM çš„æ”¯æŒï¼Œä»¥åŠå¯ä»¥å’Œè‹¹æœçš„ Cloud æœåŠ¡è¿›è¡Œé€šä¿¡ï¼Œå¯¹äºç‹¬ç«‹å¼€å‘è€…æ¥è¯´ï¼Œè¿™æ˜¯æˆæœ¬å¾ˆä½çš„æ•°æ®å­˜å‚¨æ–¹æ¡ˆï¼Œç›®å‰ä¹Ÿæ˜¯å¾ˆå¤šå¼€å‘è€…ä½¿ç”¨çš„æŠ€æœ¯æ ˆã€‚</p> <p>Core Data æˆ‘è‡ªå·±æ„Ÿè§‰ç¨å¾®æœ‰ä¸€å®šçš„ä½¿ç”¨é—¨æ§›ï¼Œä¸è¿‡è‹¹æœè¿™å‡ å¹´ä¹Ÿåœ¨ä¸æ–­åœ°é™ä½CoreData API å’Œç›¸å…³æ¦‚å¿µçš„ä½¿ç”¨å’Œç†è§£éš¾åº¦ï¼Œè¿™éƒ¨åˆ†çš„æŠ€æœ¯å‚¨å¤‡è¿˜æ˜¯è¦è¿›è¡Œçš„ã€‚</p> <p>æˆ‘å°è¯•ä» CoreData Stack è¿™é‡Œå¼€å§‹ç†æ¸… CoreData ç›¸å…³çš„æ¯”è¾ƒéš¾ç†è§£çš„æ¦‚å¿µã€‚äº‹å®ä¸Šä¹Ÿå°± CoreData Stack è¿™é‡Œæ¯”è¾ƒéš¾ç†è§£ã€‚</p> <h2 id="coredata-stack"><a href="#coredata-stack" class="header-anchor">#</a> CoreData Stack</h2> <p>CoreData Stack å°±æ˜¯ä¸€ç»„ framework å¯¹è±¡ï¼Œè¿™ç»„å¯¹è±¡ä½œä¸º CoreData åˆå§‹åŒ–éƒ¨åˆ†ä»¥åŠç”¨äºç®¡ç†åœ¨åº”ç”¨å†…å¯¹è±¡å’Œå¤–éƒ¨æ•°æ®æºäº¤äº’ã€‚CoreData Stack è´Ÿè´£æ‰€æœ‰å’Œå¤–éƒ¨æ•°æ®æºæ‰“äº¤é“å·¥ä½œï¼Œè¿™æ ·æˆ‘ä»¬ä¸šåŠ¡æ–¹åªéœ€è¦å…³å¿ƒè‡ªå·±çš„ä¸šåŠ¡é€»è¾‘å°±å¯ä»¥äº†ã€‚CoreData Stack ä¸»è¦åŒ…å«å››ç§å¯¹è±¡</p> <ol><li>NSManagedObjectContext</li> <li>NSPersistentStoreCoordinator,</li> <li>NSManagedObjectModel</li> <li>NSPersistentContainer</li></ol> <p>æ¥ä¸‹æ¥ä¸€ä¸ªä¸ªè¯´ä¸‹è¿™å‡ ä¸ªå…³é”®å¯¹è±¡</p> <ol><li><strong>NSManagedObjectModel ğŸ‘‰</strong>Â è¿™ä¸ªÂ <code>NSManagedObjectModel</code> å®ä¾‹æè¿°äº†è¢« CoreData Stack è®¿é—®çš„æ•°æ®ã€‚å…¶å®å°±æ˜¯ç”¨ç¨‹åºåŒ–çš„æ–¹å¼æè¿°äº†Â <em>.xcdatamodeld</em> é‡Œçš„å¯¹è±¡ã€‚å½“å¼€å§‹åˆå§‹åŒ–Â Core Data stack çš„æ—¶å€™ï¼Œæ•°æ®åº“æ–‡ä»¶æœ€å…ˆè¢«åŠ è½½è¿›å†…å­˜å’Œ <code>NSManagedObjectModel</code> å½¢æˆæ˜ å°„å…³ç³»ï¼Œç³»ç»Ÿå½“ç„¶çŸ¥é“è¦åŠ è½½çš„æ–‡ä»¶çš„åå­—ã€‚</li> <li><strong>NSPersistentStoreCoordinator</strong> <strong>ğŸ‘‰</strong> Â ä½äº CoreData Stack çš„ä¸­é—´å±‚ï¼Œè´Ÿè´£å°†å®šä¹‰åœ¨ model é‡Œçš„å®ä½“å®ä¾‹åŒ–ï¼Œä¹Ÿå¯ä»¥ä»æŒä¹…åŒ–å­˜å‚¨(<code>NSPersistentStore</code>)é‡Œè·å–å®ä¾‹ã€‚æ‰€ä»¥å®ƒçš„èŒè´£å°±æ˜¯æ ¹æ® Â <code>NSManagedObjectModel</code> çš„å®šä¹‰ï¼Œä»æŒä¹…åŒ–å­˜å‚¨é‡Œå–å‡ºæˆ–è€…åˆ›é€ å®ä¾‹å¯¹è±¡ï¼Œå¹¶ä¸”å°†è¿™äº›å¯¹è±¡ä¼ ç»™Â <code>NSManagedObjectContext</code>. åŒæ—¶ä¹Ÿä¼šæ ¡éªŒæ•°æ®çš„ä¸€è‡´æ€§?(è¿™ä¸ªä¸æ˜¯å¾ˆæ˜ç™½)</li> <li><strong>NSManagedObjectContext</strong> ğŸ‘‰ è¿™ä¸ªå¯¹è±¡æ˜¯æˆ‘ä»¬åº”ç”¨è°ƒç”¨æœ€å¤šçš„ï¼Œåº”ç”¨å°±æ˜¯é€šè¿‡å®ƒä»æŒä¹…åŒ–å­˜å‚¨(persistent store)è·å–ä¸€ä»½ä¸´æ—¶çš„æ•°æ®ï¼Œç„¶ååº”ç”¨å¯ä»¥ä»»æ„æ”¹å˜è¿™ä»½æ•°æ®ï¼Œå¦‚æœä½ ä¸ä¸»åŠ¨è°ƒsaveæ–¹æ³•ï¼Œé‚£æŒä¹…åŒ–å­˜å‚¨é‡Œçš„æ•°æ®æ˜¯ä¿æŒä¸å˜çš„ã€‚æˆ‘ä»¬å°±æ˜¯é€šè¿‡è¿™ä¸ª context æ¥å¯¹æ•°æ®è¿›è¡Œå¢åˆ ç­‰æ“ä½œï¼Œè¿™ä¸ª context ä¹Ÿä¼šè¿½è¸ªæˆ‘ä»¬åšäº†å“ªäº›æ“ä½œï¼Œè¿™æ ·å®ƒå°±å¯ä»¥è¯•ä¸‹undo/redo è¿™äº›æ“ä½œäº†ã€‚è€Œå½“æˆ‘ä»¬ä¸»åŠ¨è°ƒ save æ–¹æ³•çš„æ—¶å€™ï¼Œcontext ä¼šç¡®ä¿æˆ‘ä»¬çš„æ•°æ®æ˜¯æœ‰æ•ˆçš„ï¼Œæœ‰æ•ˆçš„è¯å°±ç›´æ¥å†™å›åˆ°æŒä¹…åŒ–å­˜å‚¨é‡Œé¢ã€‚</li></ol> <p><img src="/assets/img/coredata_stack.b248baa4.png" alt="CoreDataStack"></p> <h3 id="coredata-stack-åˆå§‹åŒ–"><a href="#coredata-stack-åˆå§‹åŒ–" class="header-anchor">#</a> CoreData Stack åˆå§‹åŒ–</h3> <p>æˆ‘ä»¬åªèƒ½åœ¨åˆå§‹åŒ– CoreDataStack æ ˆä¹‹åæ‰èƒ½åœ¨åº”ç”¨ä¸­è®¿é—®å¤–éƒ¨æ•°æ®æºï¼Œä¸‹é¢è¿™å‡ è¡Œä»£ç å°±æ˜¯ CoreDataStack çš„åˆ›å»ºï¼š</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code>lazy <span class="token keyword">var</span> <span class="token literal-property property">persistentContainer</span><span class="token operator">:</span> NSPersistentContainer <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> container <span class="token operator">=</span> <span class="token function">NSPersistentContainer</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token string">&quot;CoreDataDemo&quot;</span><span class="token punctuation">)</span>
    container<span class="token punctuation">.</span><span class="token function">loadPersistentStores</span><span class="token punctuation">(</span>completionHandler<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">(</span>storeDescription<span class="token punctuation">,</span> error<span class="token punctuation">)</span> <span class="token keyword">in</span>
        <span class="token keyword">if</span> <span class="token keyword">let</span> error <span class="token operator">=</span> error <span class="token keyword">as</span> NSError<span class="token operator">?</span> <span class="token punctuation">{</span>
            <span class="token function">NSLog</span><span class="token punctuation">(</span>@<span class="token string">&quot;Failed to load Core Data stack: %@&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">fatalError</span><span class="token punctuation">(</span><span class="token string">&quot;Unresolved error \(error), \(error.userInfo)&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> container
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>loadPersistentStores(completionHandler:) API è¯´æ˜ï¼šOnce the persistent container has been initialized, you need to execute <code>loadPersistentStores(completionHandler:)</code> to instruct the container to load the persistent stores and complete the creation of the Core Data stack. <strong>Once the completion handler has fired, the stack is fully initialized and is ready for use.</strong> The completion handler will be called once for each persistent store that is created.</p></blockquote> <p>å¯ä»¥çœ‹åˆ°æ‰€è°“ CoreData Stack çš„åˆå§‹åŒ–å…¶å®å°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ª <code>NSPersistentContainer</code>ï¼Œç„¶åå»åŠ è½½äº†æœ¬åœ°çš„æŒä¹…åŒ–å­˜å‚¨ã€‚</p> <p>æœ¬è´¨ä¸Š <code>NSPersistentContainer</code> çš„ä½¿ç”¨å…¶å®æ˜¯æŠŠ CoreData Stack çš„æ¯”è¾ƒå¤æ‚çš„æµç¨‹å°è£…èµ·æ¥äº†ï¼Œå½“æˆ‘ä»¬åˆ›å»º <code>NSPersistentContainer</code> çš„æ—¶å€™ï¼Œæœ¬è´¨ä¸Šä¹Ÿåˆ›å»ºäº† <code>NSManagedObjectModel</code>ï¼Œ<code>NSPersistentStoreCoordinator</code> ä»¥åŠ <code>NSManagedObjectContext</code>ã€‚</p> <p>åœ¨ iOS10 ä¹‹å‰è¿˜æœ‰ä¸€ç§æ¯”è¾ƒåŸå§‹çš„çš„ CoreData Stack åˆå§‹æ–¹å¼ï¼Œåœ¨è¿™ç§æ–¹å¼é‡Œï¼Œä½ å¯ä»¥æ¯”è¾ƒæ¸…æ¥šçš„çœ‹åˆ° CoreData Stack é‡Œçš„å¯¹è±¡æ˜¯å¦‚ä½•åä½œçš„ã€‚</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token function">init</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">completionClosure</span><span class="token operator">:</span> @<span class="token function">escaping</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//1. åˆå§‹åŒ– NSManagedObjectModel.</span>
    <span class="token comment">//2. é€šè¿‡ NSManagedObjectModel åˆå§‹åŒ– NSPersistentStoreCoordinator</span>
    <span class="token comment">//3. é€šè¿‡ NSPersistentStoreCoordinator åˆå§‹åŒ– NSManagedContext.</span>
    <span class="token comment">//This resource is the same name as your xcdatamodeld contained in your project</span>
    guard <span class="token keyword">let</span> modelURL <span class="token operator">=</span> Bundle<span class="token punctuation">.</span>main<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span>forResource<span class="token operator">:</span> <span class="token string">&quot;DataModel&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">withExtension</span><span class="token operator">:</span><span class="token string">&quot;momd&quot;</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">fatalError</span><span class="token punctuation">(</span><span class="token string">&quot;Error loading model from bundle&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// The managed object model for the application. It is a fatal error for the application not to be able to find and load its model.</span>
    guard <span class="token keyword">let</span> mom <span class="token operator">=</span> <span class="token function">NSManagedObjectModel</span><span class="token punctuation">(</span>contentsOf<span class="token operator">:</span> modelURL<span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">fatalError</span><span class="token punctuation">(</span><span class="token string">&quot;Error initializing mom from: \(modelURL)&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
	  <span class="token comment">//</span>
    <span class="token keyword">let</span> psc <span class="token operator">=</span> <span class="token function">NSPersistentStoreCoordinator</span><span class="token punctuation">(</span>managedObjectModel<span class="token operator">:</span> mom<span class="token punctuation">)</span>
    managedObjectContext <span class="token operator">=</span> <span class="token function">NSManagedObjectContext</span><span class="token punctuation">(</span>concurrencyType<span class="token operator">:</span> NSManagedObjectContextConcurrencyType<span class="token punctuation">.</span>mainQueueConcurrencyType<span class="token punctuation">)</span>
    managedObjectContext<span class="token punctuation">.</span>persistentStoreCoordinator <span class="token operator">=</span> psc
    <span class="token comment">//</span>
    <span class="token keyword">let</span> queue <span class="token operator">=</span> DispatchQueue<span class="token punctuation">.</span><span class="token function">global</span><span class="token punctuation">(</span>qos<span class="token operator">:</span> DispatchQoS<span class="token punctuation">.</span>QoSClass<span class="token punctuation">.</span>background<span class="token punctuation">)</span>
    queue<span class="token punctuation">.</span>async <span class="token punctuation">{</span>
        guard <span class="token keyword">let</span> docURL <span class="token operator">=</span> FileManager<span class="token punctuation">.</span>default<span class="token punctuation">.</span><span class="token function">urls</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token operator">:</span> <span class="token punctuation">.</span>documentDirectory<span class="token punctuation">,</span> <span class="token keyword">in</span><span class="token operator">:</span> <span class="token punctuation">.</span>userDomainMask<span class="token punctuation">)</span><span class="token punctuation">.</span>last <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">fatalError</span><span class="token punctuation">(</span><span class="token string">&quot;Unable to resolve document directory&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> storeURL <span class="token operator">=</span> docURL<span class="token punctuation">.</span><span class="token function">appendingPathComponent</span><span class="token punctuation">(</span><span class="token string">&quot;DataModel.sqlite&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">do</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> psc<span class="token punctuation">.</span><span class="token function">addPersistentStore</span><span class="token punctuation">(</span>ofType<span class="token operator">:</span> NSSQLiteStoreType<span class="token punctuation">,</span> <span class="token literal-property property">configurationName</span><span class="token operator">:</span> nil<span class="token punctuation">,</span> <span class="token literal-property property">at</span><span class="token operator">:</span> storeURL<span class="token punctuation">,</span> <span class="token literal-property property">options</span><span class="token operator">:</span> nil<span class="token punctuation">)</span>
            <span class="token comment">//The callback block is expected to complete the User Interface and therefore should be presented back on the main queue so that the user interface does not need to be concerned with which queue this call is coming from.</span>
            DispatchQueue<span class="token punctuation">.</span>main<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span>execute<span class="token operator">:</span> completionClosure<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
            <span class="token function">fatalError</span><span class="token punctuation">(</span><span class="token string">&quot;Error migrating store: \(error)&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ä½†æ˜¯ä¸Šé¢è¿™äº›åˆ›å»ºæµç¨‹çœ‹èµ·æ¥å®åœ¨å¤æ‚ï¼Œäºæ˜¯å‡ºç°äº† <code>NSPersistentContainer</code> æ¥ç®€åŒ– CoreData Stack çš„åˆå§‹åŒ–æµç¨‹ã€‚<code>NSPersistentContainer</code> ä¹Ÿæä¾›äº†é…ç½®ç±» <code>NSPersistentStoreDescription</code> æ¥ç®€åŒ– CoreData çš„é…ç½®ï¼Œæˆ‘ä»¬åœ¨åé¢ä¼šä¸æ–­çœ‹åˆ° CoreData çš„é…ç½®ã€‚</p> <p>å‚è€ƒåœ°å€:</p> <ol><li><a href="https://www.notion.so/CoreData-CloudKit-ccb9e515679e4bb290d4a0d2b3602f77" target="_blank" rel="noopener noreferrer">Core Data Programming Guide-Initializing the Core Data Stack<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.fatbobman.com/posts/masteringOfCoreDataStack/" target="_blank" rel="noopener noreferrer">è‚˜å­çš„Swiftè®°äº‹æœ¬-æŒæ¡ Core Data Stack<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol> <p>ç›¸å…³é“¾æ¥:</p> <ul><li><a href="https://fanthus.github.io/2022/11/08/coredata%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-1/" target="_blank" rel="noopener noreferrer">CoreDataå­¦ä¹ ç¬”è®° 1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://fanthus.github.io/2022/11/24/coredata%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-2/" target="_blank" rel="noopener noreferrer">CoreDataå­¦ä¹ ç¬”è®° 2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://fanthus.github.io/2022/11/24/coredata%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-3/" target="_blank" rel="noopener noreferrer">CoreDataå­¦ä¹ ç¬”è®° 3<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://fanthus.github.io/2022/11/25/coredata%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-4/" target="_blank" rel="noopener noreferrer">CoreDataå­¦ä¹ ç¬”è®° 4<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <!----></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#coredata-stack" title="CoreData Stack">CoreData Stack</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#coredata-stack-åˆå§‹åŒ–" title="CoreData Stack åˆå§‹åŒ–">CoreData Stack åˆå§‹åŒ–</a></div></div></div></div> <footer class="footer" data-v-3d9deeb8><div class="footer-left-wrap" data-v-3d9deeb8><ul class="contact" data-v-3d9deeb8></ul></div> <div class="footer-right-wrap" data-v-3d9deeb8><ul class="copyright" data-v-3d9deeb8></ul></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2cedb1d8.js" defer></script><script src="/assets/js/29.309f71c0.js" defer></script><script src="/assets/js/3.e78f3171.js" defer></script><script src="/assets/js/60.417e91a2.js" defer></script>
  </body>
</html>
