(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{323:function(t,s,a){t.exports=a.p+"assets/img/wechat_qrcode.c0c8a471.png"},642:function(t,s,a){"use strict";a.r(s);var n=a(5),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("目前看到有两种实现小程序下拉刷新的方法")]),t._v(" "),s("ol",[s("li",[t._v("使用系统提供的 onPullDownRefresh")]),t._v(" "),s("li",[t._v("使用 scroll-view 组件实现下拉刷新")])]),t._v(" "),s("h2",{attrs:{id:"使用-onpulldownrefresh-实现下拉刷新"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-onpulldownrefresh-实现下拉刷新"}},[t._v("#")]),t._v(" 使用 onPullDownRefresh 实现下拉刷新")]),t._v(" "),s("p",[t._v("主要是通过在 .json 里面进行配置实现下拉刷新，而且不光可以用在当前页面，也可以用在全局 json 配置文件中。")]),t._v(" "),s("p",[t._v("如果在全局 app.json 的 windows 配置下开启就会开启全局下拉刷新（默认情况是关闭的），小程序内的所有页面都会开启下拉刷新。")]),t._v(" "),s("div",{staticClass:"language-swift extra-class"},[s("pre",{pre:!0,attrs:{class:"language-swift"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string-literal"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pages"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string-literal"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"window"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string-literal"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"enablePullDownRefresh"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("一般来说不会全局打开这个配置，因为大部分页面应该并不需要下拉刷新，比如设置相关的页面。所以全局的下拉刷新是关闭的，如果我们想要在某个页面单独配置下拉刷新的话，可以再这个页面的  json 中单独进行配置。如果全局的下拉刷新配置和页面下拉刷新配置冲突的话，以页面的下拉刷新配置为准。")]),t._v(" "),s("p",[t._v("下拉刷新会触发页面中的 "),s("code",[t._v("onPullDownRefresh")]),t._v(" 方法，这个方法如果我们是创建 Pages 页面的话，IDE 会自动生成这个方法，我们只需要在里面实现自己的业务逻辑就好了。如果自己也实现的话两个方法会冲突，导致执行异常，所以这儿需要注意一下。")]),t._v(" "),s("p",[t._v("总的使用步骤如下")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("在当前页面中开启下拉刷新")])]),t._v(" "),s("li",[s("p",[t._v("在页面中实现 "),s("code",[t._v("onPullDownRefresh")]),t._v(" 方法，实现自己的下拉刷新业务逻辑")])]),t._v(" "),s("li",[s("p",[t._v("在下拉刷新业务逻辑结束之后停止下拉刷新。代码逻辑大致如下")]),t._v(" "),s("div",{staticClass:"language-swift extra-class"},[s("pre",{pre:!0,attrs:{class:"language-swift"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 页面相关事件处理函数--监听用户下拉动作")]),t._v("\nonPullDownRefresh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("doNetRequest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" finally "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    wx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("stopPullDownRefresh")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])]),t._v(" "),s("p",[t._v("Note")]),t._v(" "),s("ol",[s("li",[t._v("如果想要手动触发下拉刷新，可以使用 "),s("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/ui/pull-down-refresh/wx.startPullDownRefresh.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("wx.startPullDownRefresh"),s("OutboundLink")],1),t._v(" 这个 API。")])]),t._v(" "),s("h2",{attrs:{id:"使用-scroll-view-组件实现下拉刷新"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-scroll-view-组件实现下拉刷新"}},[t._v("#")]),t._v(" 使用 scroll-view 组件实现下拉刷新")]),t._v(" "),s("p",[t._v("直接上代码，然后解释组件对应的属性的作用")]),t._v(" "),s("div",{staticClass:"language-swift extra-class"},[s("pre",{pre:!0,attrs:{class:"language-swift"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//index.xml")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("scroll"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("view "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string-literal"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"scroll-style"')])]),t._v(" bindrefresherrefresh"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string-literal"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"handleRefresh"')])]),t._v(" refresher"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("enabled"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string-literal"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')])]),t._v(" refresher"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("triggered"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string-literal"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{{requestFlag}}"')])]),t._v(" refresher"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("threshold"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string-literal"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{{50}}"')])]),t._v(" scroll"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("y"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string-literal"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{{true}}"')])]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("view "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string-literal"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"container"')])]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("</")]),t._v("view"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("</")]),t._v("scroll"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("view"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//index.less")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("scroll"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("style "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  height"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("calc")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),s("span",{pre:!0,attrs:{class:"token string-literal"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"100vh - 108rpx - env(safe-area-inset-bottom)"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  box"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("sizing"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" border"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("box"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  background"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("color"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token other-directive property"}},[t._v("#F8F8F8")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//index.ts")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("handleRefresh")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" this"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("doNetworkRequest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  this"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setData")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    requestFlag"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),s("p",[t._v("Note")]),t._v(" "),s("ol",[s("li",[s("p",[s("code",[t._v("bindrefresherrefresh")]),t._v(": 自定义下拉刷新触发的方法，这个 API 名字起的有点怪（但确实是两个 refresh … ），我们在对应的触发方法里面实现下拉刷新逻辑。")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("refresher-enabled")]),t._v(": 开启自定义下拉刷新")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("refresher-triggered")]),t._v(": 设置当前下拉刷新状态，true 表示下拉刷新已经被触发，false 表示下拉刷新未被触发。一般都是在方法里进行变量控制的，如图在刷新完毕之后将改变量改为 false，恢复视图原状。")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("refresher-threshold")]),t._v("  这个是下拉刷新高度阈值。但是改了之后不生效，不知道为啥… 看官方论坛似乎是个 bug.")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("scroll-y")]),t._v(" 允许纵向滚动。")])]),t._v(" "),s("li",[s("p",[t._v("关于 CSS 中指定的语句的说明")]),t._v(" "),s("div",{staticClass:"language-swift extra-class"},[s("pre",{pre:!0,attrs:{class:"language-swift"}},[s("code",[t._v("height"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("calc")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),s("span",{pre:!0,attrs:{class:"token string-literal"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"100vh - 108rpx - env(safe-area-inset-bottom)"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("env()：一个用于获取环境变量的 CSS 函数。在这个例子中，它用于获取底部安全区域的高度。")]),t._v(" "),s("p",[t._v("用 100vh（视口高度，这里表示 100% 视窗高度）减去 108rpx（我们实际例子有个底部的 tabbar）再减去安全区域高度，就是 scroll-view 高度。")]),t._v(" "),s("p",[t._v("关于 「~」 这个符号，因为我们用的是 .less 文件，less 中波浪号表示转义符，将字符串转化为值。")]),t._v(" "),s("blockquote",[s("p",[s("strong",[t._v("Escaping")]),t._v(" allows you to use any random string as a property value or variable value.")])])])]),t._v(" "),s("p",[t._v("以上，感觉 onPullDownRefresh 这种方式似乎更简单，但是我在实际中使用的时候会遇到某些安卓真机下拉刷新的时候 tabbar 跟着一起被划走了，效果有点奇怪。scroll-view 实现没有奇怪的问题，而且定制化内容更多一些。")]),t._v(" "),s("p",[t._v("参考地址:")]),t._v(" "),s("ol",[s("li",[s("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/component/scroll-view.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("scroll-view 组件文档"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html#onPullDownRefresh",target:"_blank",rel:"noopener noreferrer"}},[t._v("onPullDownRefresh API 说明"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://stackoverflow.com/questions/17470149/tilde-in-css-attribute-value",target:"_blank",rel:"noopener noreferrer"}},[t._v("Tilde in CSS attribute value"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://lesscss.org/#escaping",target:"_blank",rel:"noopener noreferrer"}},[t._v("Less Escaping 说明"),s("OutboundLink")],1)])]),t._v(" "),s("hr"),t._v(" "),s("p",[t._v("关注我的微信公众号，我在上面会分享我的日常所思所想。")]),t._v(" "),s("div",{attrs:{align:"center"}},[s("img",{attrs:{src:a(323),width:"40%/"}})])])}),[],!1,null,null,null);s.default=e.exports}}]);