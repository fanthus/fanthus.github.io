(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{379:function(t,a,s){t.exports=s.p+"assets/img/coredata_stack.b248baa4.png"},621:function(t,a,s){"use strict";s.r(a);var e=s(5),n=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("这篇笔记主要是介绍一些 CoreData 的基本概念。Core Data 是苹果提供的数据持久化方案。相对于 Sqlite，CoreData 提供了原生的 ORM 的支持，以及可以和苹果的 Cloud 服务进行通信，对于独立开发者来说，这是成本很低的数据存储方案，目前也是很多开发者使用的技术栈。")]),t._v(" "),a("p",[t._v("Core Data 我自己感觉稍微有一定的使用门槛，不过苹果这几年也在不断地降低CoreData API 和相关概念的使用和理解难度，这部分的技术储备还是要进行的。")]),t._v(" "),a("p",[t._v("我尝试从 CoreData Stack 这里开始理清 CoreData 相关的比较难理解的概念。事实上也就 CoreData Stack 这里比较难理解。")]),t._v(" "),a("h2",{attrs:{id:"coredata-stack"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#coredata-stack"}},[t._v("#")]),t._v(" CoreData Stack")]),t._v(" "),a("p",[t._v("CoreData Stack 就是一组 framework 对象，这组对象作为 CoreData 初始化部分以及用于管理在应用内对象和外部数据源交互。CoreData Stack 负责所有和外部数据源打交道工作，这样我们业务方只需要关心自己的业务逻辑就可以了。CoreData Stack 主要包含四种对象")]),t._v(" "),a("ol",[a("li",[t._v("NSManagedObjectContext")]),t._v(" "),a("li",[t._v("NSPersistentStoreCoordinator,")]),t._v(" "),a("li",[t._v("NSManagedObjectModel")]),t._v(" "),a("li",[t._v("NSPersistentContainer")])]),t._v(" "),a("p",[t._v("接下来一个个说下这几个关键对象")]),t._v(" "),a("ol",[a("li",[a("strong",[t._v("NSManagedObjectModel 👉")]),t._v(" 这个 "),a("code",[t._v("NSManagedObjectModel")]),t._v(" 实例描述了被 CoreData Stack 访问的数据。其实就是用程序化的方式描述了 "),a("em",[t._v(".xcdatamodeld")]),t._v(" 里的对象。当开始初始化 Core Data stack 的时候，数据库文件最先被加载进内存和 "),a("code",[t._v("NSManagedObjectModel")]),t._v(" 形成映射关系，系统当然知道要加载的文件的名字。")]),t._v(" "),a("li",[a("strong",[t._v("NSPersistentStoreCoordinator")]),t._v(" "),a("strong",[t._v("👉")]),t._v("  位于 CoreData Stack 的中间层，负责将定义在 model 里的实体实例化，也可以从持久化存储("),a("code",[t._v("NSPersistentStore")]),t._v(")里获取实例。所以它的职责就是根据  "),a("code",[t._v("NSManagedObjectModel")]),t._v(" 的定义，从持久化存储里取出或者创造实例对象，并且将这些对象传给 "),a("code",[t._v("NSManagedObjectContext")]),t._v(". 同时也会校验数据的一致性?(这个不是很明白)")]),t._v(" "),a("li",[a("strong",[t._v("NSManagedObjectContext")]),t._v(" 👉 这个对象是我们应用调用最多的，应用就是通过它从持久化存储(persistent store)获取一份临时的数据，然后应用可以任意改变这份数据，如果你不主动调save方法，那持久化存储里的数据是保持不变的。我们就是通过这个 context 来对数据进行增删等操作，这个 context 也会追踪我们做了哪些操作，这样它就可以试下undo/redo 这些操作了。而当我们主动调 save 方法的时候，context 会确保我们的数据是有效的，有效的话就直接写回到持久化存储里面。")])]),t._v(" "),a("p",[a("img",{attrs:{src:s(379),alt:"CoreDataStack"}})]),t._v(" "),a("h3",{attrs:{id:"coredata-stack-初始化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#coredata-stack-初始化"}},[t._v("#")]),t._v(" CoreData Stack 初始化")]),t._v(" "),a("p",[t._v("我们只能在初始化 CoreDataStack 栈之后才能在应用中访问外部数据源，下面这几行代码就是 CoreDataStack 的创建：")]),t._v(" "),a("div",{staticClass:"language-jsx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-jsx"}},[a("code",[t._v("lazy "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("persistentContainer")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" NSPersistentContainer "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" container "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("NSPersistentContainer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"CoreDataDemo"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    container"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("loadPersistentStores")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("completionHandler"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("storeDescription"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" error "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" error "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" NSError"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("NSLog")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("@"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Failed to load Core Data stack: %@"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fatalError")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Unresolved error \\(error), \\(error.userInfo)"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" container\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("loadPersistentStores(completionHandler:) API 说明：Once the persistent container has been initialized, you need to execute "),a("code",[t._v("loadPersistentStores(completionHandler:)")]),t._v(" to instruct the container to load the persistent stores and complete the creation of the Core Data stack. "),a("strong",[t._v("Once the completion handler has fired, the stack is fully initialized and is ready for use.")]),t._v(" The completion handler will be called once for each persistent store that is created.")])]),t._v(" "),a("p",[t._v("可以看到所谓 CoreData Stack 的初始化其实就是创建了一个 "),a("code",[t._v("NSPersistentContainer")]),t._v("，然后去加载了本地的持久化存储。")]),t._v(" "),a("p",[t._v("本质上 "),a("code",[t._v("NSPersistentContainer")]),t._v(" 的使用其实是把 CoreData Stack 的比较复杂的流程封装起来了，当我们创建 "),a("code",[t._v("NSPersistentContainer")]),t._v(" 的时候，本质上也创建了 "),a("code",[t._v("NSManagedObjectModel")]),t._v("，"),a("code",[t._v("NSPersistentStoreCoordinator")]),t._v(" 以及 "),a("code",[t._v("NSManagedObjectContext")]),t._v("。")]),t._v(" "),a("p",[t._v("在 iOS10 之前还有一种比较原始的的 CoreData Stack 初始方式，在这种方式里，你可以比较清楚的看到 CoreData Stack 里的对象是如何协作的。")]),t._v(" "),a("div",{staticClass:"language-jsx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-jsx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("init")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("completionClosure")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" @"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("escaping")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//1. 初始化 NSManagedObjectModel.")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//2. 通过 NSManagedObjectModel 初始化 NSPersistentStoreCoordinator")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//3. 通过 NSPersistentStoreCoordinator 初始化 NSManagedContext.")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//This resource is the same name as your xcdatamodeld contained in your project")]),t._v("\n    guard "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" modelURL "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Bundle"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("url")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("forResource"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DataModel"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("withExtension")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"momd"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fatalError")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Error loading model from bundle"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// The managed object model for the application. It is a fatal error for the application not to be able to find and load its model.")]),t._v("\n    guard "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" mom "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("NSManagedObjectModel")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("contentsOf"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" modelURL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fatalError")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Error initializing mom from: \\(modelURL)"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" psc "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("NSPersistentStoreCoordinator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("managedObjectModel"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" mom"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    managedObjectContext "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("NSManagedObjectContext")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("concurrencyType"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" NSManagedObjectContextConcurrencyType"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mainQueueConcurrencyType"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    managedObjectContext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("persistentStoreCoordinator "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" psc\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" queue "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" DispatchQueue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("global")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("qos"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" DispatchQoS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("QoSClass"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("background"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    queue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("async "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        guard "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" docURL "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" FileManager"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("default"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("urls")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("documentDirectory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("userDomainMask"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("last "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fatalError")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Unable to resolve document directory"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" storeURL "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" docURL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendingPathComponent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DataModel.sqlite"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" psc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addPersistentStore")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ofType"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" NSSQLiteStoreType"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("configurationName")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" nil"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("at")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" storeURL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("options")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" nil"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//The callback block is expected to complete the User Interface and therefore should be presented back on the main queue so that the user interface does not need to be concerned with which queue this call is coming from.")]),t._v("\n            DispatchQueue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("execute"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" completionClosure"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fatalError")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Error migrating store: \\(error)"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("但是上面这些创建流程看起来实在复杂，于是出现了 "),a("code",[t._v("NSPersistentContainer")]),t._v(" 来简化 CoreData Stack 的初始化流程。"),a("code",[t._v("NSPersistentContainer")]),t._v(" 也提供了配置类 "),a("code",[t._v("NSPersistentStoreDescription")]),t._v(" 来简化 CoreData 的配置，我们在后面会不断看到 CoreData 的配置。")]),t._v(" "),a("p",[t._v("参考地址:")]),t._v(" "),a("ol",[a("li",[a("a",{attrs:{href:"https://www.notion.so/CoreData-CloudKit-ccb9e515679e4bb290d4a0d2b3602f77",target:"_blank",rel:"noopener noreferrer"}},[t._v("Core Data Programming Guide-Initializing the Core Data Stack"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://www.fatbobman.com/posts/masteringOfCoreDataStack/",target:"_blank",rel:"noopener noreferrer"}},[t._v("肘子的Swift记事本-掌握 Core Data Stack"),a("OutboundLink")],1)])]),t._v(" "),a("p",[t._v("相关链接:")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://fanthus.github.io/2022/11/08/coredata%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-1/",target:"_blank",rel:"noopener noreferrer"}},[t._v("CoreData学习笔记 1"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://fanthus.github.io/2022/11/24/coredata%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-2/",target:"_blank",rel:"noopener noreferrer"}},[t._v("CoreData学习笔记 2"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://fanthus.github.io/2022/11/24/coredata%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-3/",target:"_blank",rel:"noopener noreferrer"}},[t._v("CoreData学习笔记 3"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://fanthus.github.io/2022/11/25/coredata%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-4/",target:"_blank",rel:"noopener noreferrer"}},[t._v("CoreData学习笔记 4"),a("OutboundLink")],1)])]),t._v(" "),a("Vssue",{attrs:{title:t.CoreData学习笔记_1}})],1)}),[],!1,null,null,null);a.default=n.exports}}]);