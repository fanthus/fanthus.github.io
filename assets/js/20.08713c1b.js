(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{404:function(t,e,_){t.exports=_.p+"assets/img/Untitled.d2ffbbd7.png"},405:function(t,e,_){t.exports=_.p+"assets/img/Untitled_1.9b94b434.png"},406:function(t,e,_){t.exports=_.p+"assets/img/Untitled_2.c96fd00c.png"},407:function(t,e,_){t.exports=_.p+"assets/img/Untitled_3.f0434ca9.png"},408:function(t,e,_){t.exports=_.p+"assets/img/Untitled_4.08d21ddb.png"},652:function(t,e,_){"use strict";_.r(e);var v=_(5),s=Object(v.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("p",[t._v("HTTPS 相对于 HTTP 来说最重要的一点改变就是增加了传输加密的功能，避免了数据在网络上的明文传输。HTTPS 能做到这一点依赖于 SSL/TLS 的工作，SSL 是基于 HTTPS 下的一个协议加密层。")]),t._v(" "),e("blockquote",[e("p",[t._v("SSL(Secure Socket Layer)安全套接层，是1994年由Netscape公司设计的一套协议，并与1995年发布了3.0版本。")]),t._v(" "),e("p",[t._v("TLS(Transport Layer Security)传输层安全是 IETF 在 SSL3.0 基础上设计的协议，实际上相当于SSL的后续版本。\n在实际使用的时候这两者的命名是有点混淆的，所以知道这两者的关系就 OK 了，本文后面统一用 SSL 了。")])]),t._v(" "),e("p",[t._v("从具体架构层级上来看 HTTPS 是对 HTTP 的拓展，在 TCP 层之上，增加了 SSL/TLS 加密层。")]),t._v(" "),e("p",[e("img",{attrs:{src:_(404),alt:"Untitled"}})]),t._v(" "),e("p",[t._v("HTTPS 建立连接传输数据的大概流程是：客户端通过服务端的公钥加密本地生成的一个随机数（也可以简单认为就是后续传输过程对称加密用到的 KEY），然后将加密结果发给服务端，服务端根据对应私钥去解密这个加密后的结果，拿到随机数，也就是对称加密的密钥之后，双方根据这个密钥开始进行对称加密的数据传输。")]),t._v(" "),e("p",[t._v("那 SSL/TLS 这一层来保证传输的安全性呢？这是本文想要聊的话题。")]),t._v(" "),e("h2",{attrs:{id:"ssl-tls-存在的意义"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ssl-tls-存在的意义"}},[t._v("#")]),t._v(" SSL/TLS 存在的意义")]),t._v(" "),e("p",[t._v("我觉得最主要的目的就是为了安全的让客户端和服务器交换后续传输用到的对称密钥。")]),t._v(" "),e("h2",{attrs:{id:"ssl-tls-握手概念"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ssl-tls-握手概念"}},[t._v("#")]),t._v(" SSL/TLS 握手概念")]),t._v(" "),e("p",[t._v("其实有点类似 TCP 的三次握手一样，SSL/TLS 在传输数据的过程当中也会有握手的概念，握手的的目的本质上也是为了完成密钥的生成和安全交换。")]),t._v(" "),e("h2",{attrs:{id:"ssl-tls-握手的流程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ssl-tls-握手的流程"}},[t._v("#")]),t._v(" SSL/TLS 握手的流程")]),t._v(" "),e("p",[t._v("从网上找来一张图，我学习的时候就是通过看这张图来理解 HTTPS 的传输流程的，配合下面的文字说的很清楚。")]),t._v(" "),e("p",[e("img",{attrs:{src:_(405),alt:"Untitled"}})]),t._v(" "),e("p",[t._v("具体文字版传输流程如下")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("客户端向服务器发起握手🤝请求，也就是 ‘client hello’ 消息，同时也包含如下消息")]),t._v(" "),e("ul",[e("li",[t._v("随机字符串("),e("code",[t._v("client random")]),t._v(")")]),t._v(" "),e("li",[t._v("客户端支持的加密算法")])])]),t._v(" "),e("li",[e("p",[t._v("服务器对握手请求进行相应，回应 ‘server hello’ 消息，也包含如下消息")]),t._v(" "),e("ul",[e("li",[t._v("随机字符串("),e("code",[t._v("server random")]),t._v(")")]),t._v(" "),e("li",[t._v("数字证书")]),t._v(" "),e("li",[t._v("服务器从客户端支持的加密算法列表里选择好的加密算法")])]),t._v(" "),e("blockquote",[e("p",[t._v("数字证书包含的内容很多，除了公钥信息之外，还包含签发机构，域名，有效期等信息。")])])]),t._v(" "),e("li",[e("p",[t._v("客户端收到服务器的回应之后，开始对服务器返回的信息进行如下处理")]),t._v(" "),e("ul",[e("li",[t._v("校验证书有效性")]),t._v(" "),e("li",[t._v("继续生成随机数("),e("code",[t._v("premaster secret")]),t._v(")并用服务器公钥加密")])])]),t._v(" "),e("li",[e("p",[t._v("客户端将处理完成之后将公钥加密后的随机数 "),e("code",[t._v("premaster secret")]),t._v(" 发给服务器。")])]),t._v(" "),e("li",[e("p",[t._v("服务器使用私钥解密来获取客户端的随机数 "),e("code",[t._v("premaster secret")])]),t._v(" "),e("blockquote",[e("p",[t._v("这个随机数的交换是很重要的，它保证了中间人没办法看到真正的随机数内容。")])])]),t._v(" "),e("li",[e("p",[t._v("此时客户端和服务端都有三个随机数，然后双方使用相同的加密算法来通过这三个随机数生成相同的密钥 "),e("strong",[t._v("master secret")]),t._v("。"),e("strong",[t._v("这个 KEY 就是用作最终用来对称加密传输的密钥。")])]),t._v(" "),e("blockquote",[e("p",[t._v("这步不涉及传输过程，是在双方本地完成的。")])])]),t._v(" "),e("li",[e("p",[t._v("客户端和服务端互相发送就绪消息。内容是使用 KEY 加密后的 “finished” 信号")]),t._v(" "),e("blockquote",[e("p",[t._v("这步骤本质是在验证之前的流程是对的，同时保证后续传输是没问题的")])])]),t._v(" "),e("li",[e("p",[t._v("双方认为建立安全链接，开始使用上面生成的 KEY 进行对称加密进行安全传输。")])])]),t._v(" "),e("h3",{attrs:{id:"三个随机数的作用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三个随机数的作用"}},[t._v("#")]),t._v(" 三个随机数的作用")]),t._v(" "),e("p",[t._v("上面的传输过程涉及到三个随机数: ① 客户端生成的 "),e("code",[t._v("client random")]),t._v(" ② 服务端生成的 "),e("code",[t._v("server random")]),t._v(" ③ 最后一步客户端生成的 "),e("code",[t._v("premaster secret")]),t._v("。")]),t._v(" "),e("p",[t._v("这三个随机数最终的目的是生成 "),e("code",[t._v("master Secret")]),t._v("，这个三个随机数都会在服务器和客户端之间记性传输，但是 "),e("strong",[t._v("最终的 "),e("code",[t._v("master secret")]),t._v(" 是不会在两端传输的")]),t._v(" ，而是通过一个约定好的算法生成。")]),t._v(" "),e("p",[e("code",[t._v("premaster secret")]),t._v(" 和 "),e("code",[t._v("client random")]),t._v("/"),e("code",[t._v("server random")]),t._v(" 的区别在于："),e("strong",[t._v("它的传输是用公钥加密的，而后两者是明文传输的")]),t._v("。这样第三方是没有办法完整的拿到这三个随机数，也就没有办法生成 "),e("code",[t._v("master Secret")]),t._v("。")]),t._v(" "),e("h2",{attrs:{id:"ssl-tls-涉及到的一些概念"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ssl-tls-涉及到的一些概念"}},[t._v("#")]),t._v(" SSL/TLS 涉及到的一些概念")]),t._v(" "),e("p",[t._v("**数字证书。**数字证书本质是证书认证机构(CA)颁发的，一般包含以下内容：公钥、名称、颁发者、有效期、SHA-256指纹、签名算法，序列号（这是证书颁发机构为该证书分配的唯一标识符）。")]),t._v(" "),e("p",[e("img",{attrs:{src:_(406),alt:"Untitled"}})]),t._v(" "),e("p",[t._v("**证书链 (certificate chain)：**包含根证书、中间证书、用户证书，是组成一条完整证书的信任链。用于认证实体合法身份的证书列表，只有当整个证书信任链上的各个证书都有效时，浏览器才会认定当前颁发给用户的证书是有效和受信任的。")]),t._v(" "),e("p",[e("img",{attrs:{src:_(407),alt:"Untitled"}})]),t._v(" "),e("h2",{attrs:{id:"ssl-tls-设计到的实际应用场景"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ssl-tls-设计到的实际应用场景"}},[t._v("#")]),t._v(" SSL/TLS 设计到的实际应用场景")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("有的时候看到下面这种情况的时候，尽管是https链接方式，但还是报安全隐患，需要在浏览器的地址栏左侧查看一下证书的有效期是不是过了。")]),t._v(" "),e("p",[e("img",{attrs:{src:_(408),alt:"Untitled"}})])]),t._v(" "),e("li",[e("p",[t._v("客户端开发过程中的证书锁定。默认情况下 App 种进行 TLS 传输的时候，系统会自动验证证书。不过有的时候为了防止抓包，在客户端本地内置证书或者公钥，这样在客户端验证服务端下发证书的过程中，就能判定和自己对话的到底是不是真的服务端，如果不是的话，证书就会校验失败，SSL 握手失败，最终中断传输，达到防止抓包的目的。参考之前 "),e("a",{attrs:{href:"https://fanthus.github.io/2022/08/30/ios-%E7%A6%81%E7%94%A8%E6%8A%93%E5%8C%85/",target:"_blank",rel:"noopener noreferrer"}},[t._v("iOS 禁用抓包实践"),e("OutboundLink")],1),t._v(" 这篇文章。")])])]),t._v(" "),e("p",[t._v("参考地址:")]),t._v(" "),e("ol",[e("li",[e("a",{attrs:{href:"https://segmentfault.com/a/1190000021559557?_ea=29659396",target:"_blank",rel:"noopener noreferrer"}},[t._v("HTTPS详解二：SSL / TLS 工作原理和详细握手过程"),e("OutboundLink")],1)])])])}),[],!1,null,null,null);e.default=s.exports}}]);